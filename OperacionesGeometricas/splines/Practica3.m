clear all;

% Puntos de control
P1(1,:)=[0 1 0];
P1(2,:)=[0 1 2];
P1(3,:)=[0 2 2];
P1(4,:)=[0 3 2];
P1(5,:)=[0 3 0];

P2(1,:)=[0.25 0.5 0];
P2(2,:)=[0.25 0.5 2.5];
P2(3,:)=[0.25 2 2.5];
P2(4,:)=[0.25 3.5 2.5];
P2(5,:)=[0.25 3.5 0];

P3(1,:)=[0.5 0 0];
P3(2,:)=[0.5 0 3];
P3(3,:)=[0.5 2 3];
P3(4,:)=[0.5 4 3];
P3(5,:)=[0.5 4 0];

P4(1,:)=[0.75 0 0];
P4(2,:)=[0.75 0 3];
P4(3,:)=[0.75 2 3];
P4(4,:)=[0.75 4 3];
P4(5,:)=[0.75 4 0];

P5(1,:)=[1 0 0];
P5(2,:)=[1 0 3];
P5(3,:)=[1 2 3];
P5(4,:)=[1 4 3];
P5(5,:)=[1 4 0];

P6(1,:)=[1.25 0.5 0];
P6(2,:)=[1.25 0.5 2.5];
P6(3,:)=[1.25 2 2.5];
P6(4,:)=[1.25 3.5 2.5];
P6(5,:)=[1.25 3.5 0];

P7(1,:)=[1.5 1 0];
P7(2,:)=[1.5 1 2];
P7(3,:)=[1.5 2 2];
P7(4,:)=[1.5 3 2];
P7(5,:)=[1.5 3 0];

p = 3;
q = 2;

V = [0 0 0 0.5 0.6 1 1 1];
U = [0 0 0 0 0.5 0.5 0.5 1 1 1 1];

X = P1;
X(:,:,:,2) = P2;
X(:,:,:,3) = P3;
X(:,:,:,4) = P4;
X(:,:,:,5) = P5;
X(:,:,:,6) = P6;
X(:,:,:,7) = P7;

u = 0:0.01:1;
v = 0:0.01:1;

[uF,uC] = size(u);
[vF,vC] = size(v);

for iteradorv = 1:vC-1
    for iteradoru = 1:uC-1        
        result = b_spline_boor_surface(X,U,p,V,q,u(iteradoru),v(iteradorv));
        ACUM(iteradorv,iteradoru,:) = result;
        plot3(result(1),result(2),result(3),'o');
        hold on;
    end
end

plot3(P1(:,1),P1(:,2),P1(:,3));
hold on;
plot3(P2(:,1),P2(:,2),P2(:,3));
hold on;
plot3(P3(:,1),P3(:,2),P3(:,3));
hold on;
plot3(P4(:,1),P4(:,2),P4(:,3));
hold on;
plot3(P5(:,1),P5(:,2),P5(:,3));
hold on;
plot3(P6(:,1),P6(:,2),P6(:,3));
hold on;
plot3(P7(:,1),P7(:,2),P7(:,3));
axis equal;