clear all;

% Puntos de control
P1(1,:)=[0 0 0.5];
P1(2,:)=[0 1 -0.5];
P1(3,:)=[0 2 0.5];
P1(4,:)=[0 3 -0.5];
P1(5,:)=[0 4 0.5];

P2(1,:)=[1 0 -0.5];
P2(2,:)=[1 1 0.5];
P2(3,:)=[1 2 -0.5];
P2(4,:)=[1 3 0.5];
P2(5,:)=[1 4 -0.5];

P3(1,:)=[2 0 0.5];
P3(2,:)=[2 1 -0.5];
P3(3,:)=[2 2 0.5];
P3(4,:)=[2 3 -0.5];
P3(5,:)=[2 4 0.5];

P4(1,:)=[3 0 -0.5];
P4(2,:)=[3 1 0.5];
P4(3,:)=[3 2 -0.5];
P4(4,:)=[3 3 0.5];
P4(5,:)=[3 4 -0.5];

P5(1,:)=[4 0 0.5];
P5(2,:)=[4 1 -0.5];
P5(3,:)=[4 2 0.5];
P5(4,:)=[4 3 -0.5];
P5(5,:)=[4 4 0.5];

P6(1,:)=[5 0 -0.5];
P6(2,:)=[5 1 0.5];
P6(3,:)=[5 2 -0.5];
P6(4,:)=[5 3 0.5];
P6(5,:)=[5 4 -0.5];

P7(1,:)=[6 0 0.5];
P7(2,:)=[6 1 -0.5];
P7(3,:)=[6 2 0.5];
P7(4,:)=[6 3 -0.5];
P7(5,:)=[6 4 0.5];

p = 3;
q = 2;

V = [0 0 0 0.5 0.6 1 1 1];
U = [0 0 0 0 0.5 0.5 0.5 1 1 1 1];

X = P1;
X(:,:,:,2) = P2;
X(:,:,:,3) = P3;
X(:,:,:,4) = P4;
X(:,:,:,5) = P5;
X(:,:,:,6) = P6;
X(:,:,:,7) = P7;

u = 0:0.01:1;
v = 0:0.01:1;

[uF,uC] = size(u);
[vF,vC] = size(v);

for iteradorv = 1:vC-1
    for iteradoru = 1:uC-1        
        result = b_spline_boor_surface(X,U,p,V,q,u(iteradoru),v(iteradorv));
        ACUM(iteradorv,iteradoru,:) = result;
        if iteradoru == 50 || iteradorv == 50
            plot3(result(1),result(2),result(3),'ro');
            hold on;
        end
    end
end

plot3(P1(:,1),P1(:,2),P1(:,3));
hold on;
plot3(P2(:,1),P2(:,2),P2(:,3));
hold on;
plot3(P3(:,1),P3(:,2),P3(:,3));
hold on;
plot3(P4(:,1),P4(:,2),P4(:,3));
hold on;
plot3(P5(:,1),P5(:,2),P5(:,3));
hold on;
plot3(P6(:,1),P6(:,2),P6(:,3));
hold on;
plot3(P7(:,1),P7(:,2),P7(:,3));